---

- core:
    listen: ["0.0.0.0", 8081]
    url: "https://seecloud.mirantis.com"
    secrets: /etc/rci-secrets.yaml

- service:
    module: rallyci.services.github
    name: gh
    data-path: /tmp/rci-gh
    sessions-path: /tmp/rci-gh/sessions
    urls:
      oauth2: "/rci/oauth2"
      webhook: "/rci/webhook"
      register: "/rci/register"
      settings: "/rci/settings"

- provider:
    name: os
    module: rallyci.providers.openstack
    ssh:
      default_username: ubuntu
      key_name: rci
      private_key_path: /home/eye/.ssh/test
      jumphost:
        hostname: sc
        username: ubuntu
      access_net: "rci-int-net"
    clusters:
      single_ubuntu:
        ubuntu:
          image: "rci-u1404"
          flavor: rci-1vcpu-1024ram
          interfaces:
            - ["static", "rci-int-net"]
      test_cluster:
        master:
          image: "rci-u1404"
          flavor: rci-1vcpu-1024ram
          interfaces:
            - ["static", "rci-int-net"]
            - ["dynamic", "testcluster-int-net"]
        slave1:
          image: "rci-u1404"
          flavor: rci-1vcpu-1024ram
          interfaces:
            - ["dynamic", "testcluster-int-net"]
        slave2:
          image: "rci-u1404"
          flavor: rci-1vcpu-1024ram
          interfaces:
            - ["dynamic", "testcluster-int-net"]
        slave3:
          image: "rci-u1404"
          flavor: rci-1vcpu-1024ram
          interfaces:
            - ["dynamic", "testcluster-int-net"]

- script:
    name: env
    data: |
      env

- script:
    name: gzip_logs
    data:
      gzip /var/log/syslog --stdout > /tmp/syslog.txt.gz

- job:
    name: test-job-1
    provider: os
    cluster: test_cluster
    scripts:
      master:
        - env
    post_scripts:
      master:
        - gzip_logs
    publish:
      master:
        - ["/tmp/syslog.gz", "syslog.txt.gz"]

- job:
    name: test-2
    provider: os
    cluster: test_cluster
    scripts:
      master:
        - env
    post_scripts:
      master:
        - gzip_logs
    publish:
      master:
        - ["/tmp/syslog.gz", "syslog.txt.gz"]

- matrix:
    name: seecloud
    projects:
      - seecloud/automation
      - seecloud/ceagle
      - r-ci/ci-conf
    jobs-cr:
      - test-job-1
      - test-2
    jobs-push:
      - test-job-1
      - test-2
    jobs-branch:
      - test-job-1
      - test-2
